<div class="admin-container">
  <div class="header-row">
    <h2>Commandes des clients</h2>
    <button mat-stroked-button (click)="loadOrders()">
      <mat-icon>refresh</mat-icon> Rafraîchir
    </button>
  </div>

  <div *ngIf="loading" style="text-align:center;padding:40px">
    <mat-spinner diameter="40" style="margin:auto"></mat-spinner>
  </div>

  <mat-card *ngIf="!loading">
    <table mat-table [dataSource]="orders">

      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>#</th>
        <td mat-cell *matCellDef="let o"><strong>#{{ o.id }}</strong></td>
      </ng-container>

      <!-- Client -->
      <ng-container matColumnDef="client">
        <th mat-header-cell *matHeaderCellDef>Client</th>
        <td mat-cell *matCellDef="let o">
          <div>
            <strong>{{ o.clientFullName }}</strong><br>
            <small style="color:#777">&#64;{{ o.clientUsername }}</small>
          </div>
        </td>
      </ng-container>

      <!-- Date -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let o">
          {{ o.createdAt | date:'dd/MM/yyyy HH:mm' }}
        </td>
      </ng-container>

      <!-- Nb articles -->
      <ng-container matColumnDef="items">
        <th mat-header-cell *matHeaderCellDef>Articles</th>
        <td mat-cell *matCellDef="let o">{{ o.itemCount }}</td>
      </ng-container>

      <!-- Total -->
      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef>Total</th>
        <td mat-cell *matCellDef="let o">
          <strong style="color:#3f51b5">{{ o.total | currency:'EUR' }}</strong>
        </td>
      </ng-container>

      <!-- Statut -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Statut</th>
        <td mat-cell *matCellDef="let o">
          <span [style.color]="getStatusColor(o.status)" style="font-weight:600">
            {{ getStatusLabel(o.status) }}
          </span>
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let o">
          <button mat-icon-button color="primary" (click)="openDetail(o.id)"
                  matTooltip="Voir le détail">
            <mat-icon>visibility</mat-icon>
          </button>
          <button mat-icon-button color="accent"
                  *ngIf="o.status === 'Pending'"
                  (click)="changeStatus(o.id, 'Confirmed')"
                  matTooltip="Confirmer la commande">
            <mat-icon>check_circle</mat-icon>
          </button>
          <button mat-icon-button color="warn"
                  *ngIf="o.status !== 'Cancelled'"
                  (click)="changeStatus(o.id, 'Cancelled')"
                  matTooltip="Annuler la commande">
            <mat-icon>cancel</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div *ngIf="orders.length === 0" style="text-align:center;padding:40px;color:#888">
      <mat-icon style="font-size:48px;width:48px;height:48px">receipt_long</mat-icon>
      <p>Aucune commande pour le moment.</p>
    </div>
  </mat-card>
</div>
